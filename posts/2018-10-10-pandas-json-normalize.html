<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Pandas & JSON</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <div class="margin-left"></div>

        <div class="content">
            <a href="../">&larr; Home</a>
<div class="fullwidth">
    Posted on October 10, 2018
    
        by me
    
</div>

<h2 id="json_normalize">json_normalize</h2>
<p><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.io.json.json_normalize.html">Documentation page</a></p>
<p>To transform nested JSON into a DataFrame, we can use <code>json_normalize</code> to describe how to unwrap the object. The official documentation is not very clear on how to select data from nested dicts. For example we have the following data:</p>
<pre><code>[
  { 'date': '2016-01-01',
    'daily_purchases': [
        { 'user_id': 4242,
          'ticket_purchases': [
            { 'quantity': 35, 'price': 42.0 }, { 'quantity': 1337, 'price': 42.1 }]
        },
        { 'user_id': 5565,
          'ticket_purchases': [
            { 'quantity': 666.0, 'price': 42.0 }, { 'quantity': 555.0, 'price': 42.1 }]
        }
    ]
  },
  { 'date': '2016-01-02',
    'daily_purchases': [
      { 'user_id': 5565,
        'ticket_purchases': [
          { 'quantity': 666.0, 'price': 42.0 }, { 'quantity': 555.0, 'price': 42.1 }]
      }
    ]
  },
]</code></pre>
<p>We can get a flat DataFrame with the purchase data per user in one function call:</p>
<pre><code>import pandas as pd

df = pd.io.json.json_normalize(
     data=data,                                            # dict-like object
     record_path=['daily_purchases', 'ticket_purchases'],  # the path to the data [1]
     meta=['date', ['daily_purchases', 'user_id']]         # the columns we want [2]
)

df = df.rename(columns={'daily_purchases.user_id': 'user_id'})

   price  quantity  user_id        date
0   42.0      35.0     4242  2016-01-01
1   42.1    1337.0     4242  2016-01-01
2   42.0     666.0     5565  2016-01-01
3   42.1     555.0     5565  2016-01-01
4   42.0     666.0     5565  2016-01-02
5   42.1     555.0     5565  2016-01-02</code></pre>
<p>[1] Here we pass a list of strings to be used as nested keys - we want data in <code>dict['daily_purchases']['ticket_purchases']</code>.</p>
<p>[2] We can also use a nested list here to select columns from nested objects</p>

        </div>

        <div class="margin-right"></div>

        <!--[if lte IE 9]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
        <![endif]-->
    </body>
</html>
